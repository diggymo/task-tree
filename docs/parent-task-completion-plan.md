# è¦ªã‚¿ã‚¹ã‚¯å®Œäº†çŠ¶æ…‹è‡ªå‹•è¨ˆç®—æ©Ÿèƒ½ å®Ÿè£…è¨ˆç”»

## æ¦‚è¦
å­ã‚¿ã‚¹ã‚¯ã‚’æŒã¤è¦ªã‚¿ã‚¹ã‚¯ã®å®Œäº†/æœªå®Œäº†çŠ¶æ…‹ã‚’ã€å­ã‚¿ã‚¹ã‚¯ã®çŠ¶æ…‹ã‹ã‚‰è‡ªå‹•çš„ã«è¨ˆç®—ã—ã¦è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

## è¦ä»¶

### è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
```
è¦ªã‚¿ã‚¹ã‚¯ã®å®Œäº†çŠ¶æ…‹ = ã™ã¹ã¦ã®å­ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ã¦ã„ã‚‹å ´åˆã®ã¿ã€Œå®Œäº†ã€
```

- âœ… **ã™ã¹ã¦ã®å­ã‚¿ã‚¹ã‚¯ãŒå®Œäº†** â†’ è¦ªã‚¿ã‚¹ã‚¯ã‚‚å®Œäº†ã¨ã—ã¦è¡¨ç¤º
- âŒ **1ã¤ã§ã‚‚æœªå®Œäº†ã®å­ã‚¿ã‚¹ã‚¯ãŒã‚ã‚‹** â†’ è¦ªã‚¿ã‚¹ã‚¯ã¯æœªå®Œäº†ã¨ã—ã¦è¡¨ç¤º
- ğŸ“ **å­ã‚¿ã‚¹ã‚¯ãŒãªã„ï¼ˆè‘‰ã‚¿ã‚¹ã‚¯ï¼‰** â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§è¨­å®šã—ãŸ `completed` å€¤ã‚’ä½¿ç”¨

### UIå‹•ä½œ
1. **è‘‰ã‚¿ã‚¹ã‚¯ï¼ˆå­ã‚’æŒãŸãªã„ã‚¿ã‚¹ã‚¯ï¼‰**
   - å®Œäº†ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ‰‹å‹•ã§å®Œäº†/æœªå®Œäº†ã‚’åˆ‡ã‚Šæ›¿ãˆå¯èƒ½
   - ãƒ‡ãƒ¼ã‚¿ã« `completed` ãƒ•ãƒ©ã‚°ã‚’ä¿å­˜

2. **è¦ªã‚¿ã‚¹ã‚¯ï¼ˆå­ã‚’æŒã¤ã‚¿ã‚¹ã‚¯ï¼‰**
   - å®Œäº†çŠ¶æ…‹ã¯å­ã‚¿ã‚¹ã‚¯ã‹ã‚‰è‡ªå‹•è¨ˆç®—
   - å®Œäº†ãƒœã‚¿ãƒ³ã¯ã‚¯ãƒªãƒƒã‚¯ä¸å¯ï¼ˆé€²æ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦è¡¨ç¤ºï¼‰
   - ã¾ãŸã¯ã€Œ3/5å®Œäº†ã€ã®ã‚ˆã†ãªé€²æ—è¡¨ç¤ºã«å¤‰æ›´

## å®Ÿè£…æ–¹é‡

### ãƒ‡ãƒ¼ã‚¿ã¨ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†é›¢

**ãƒ‡ãƒ¼ã‚¿å±¤ï¼ˆä¿å­˜ï¼‰:**
- `task.completed` ã¯è‘‰ã‚¿ã‚¹ã‚¯ã®ã¿ã«ä¿å­˜
- è¦ªã‚¿ã‚¹ã‚¯ã® `completed` ã¯ä¿å­˜ã›ãšã€å¸¸ã«è¨ˆç®—ã§å–å¾—

**è¡¨ç¤ºå±¤ï¼ˆUIï¼‰:**
- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã§å‹•çš„ã«å®Œäº†çŠ¶æ…‹ã‚’è¨ˆç®—
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯è¨ˆç®—çµæœã‚’ä½¿ç”¨ã—ã¦è¡¨ç¤º

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

#### 1. `src/utils/taskOperations.ts` - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°è¿½åŠ 

```typescript
/**
 * ã‚¿ã‚¹ã‚¯ã®å®Œäº†çŠ¶æ…‹ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆå­ã‚¿ã‚¹ã‚¯ã‹ã‚‰å†å¸°çš„ã«è¨ˆç®—ï¼‰
 * - å­ã‚¿ã‚¹ã‚¯ãŒã‚ã‚‹å ´åˆ: ã™ã¹ã¦ã®å­ãŒå®Œäº†ã—ã¦ã„ã‚Œã° true
 * - å­ã‚¿ã‚¹ã‚¯ãŒãªã„å ´åˆ: task.completed ã®å€¤ã‚’è¿”ã™
 */
export function isTaskCompleted(task: TaskNode): boolean {
  if (task.children.length === 0) {
    // è‘‰ã‚¿ã‚¹ã‚¯: ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ completed å€¤ã‚’è¿”ã™
    return task.completed ?? false;
  }

  // è¦ªã‚¿ã‚¹ã‚¯: ã™ã¹ã¦ã®å­ãŒå®Œäº†ã—ã¦ã„ã‚Œã° true
  return task.children.every(child => isTaskCompleted(child));
}

/**
 * ã‚¿ã‚¹ã‚¯ãŒè¦ªã‚¿ã‚¹ã‚¯ã‹ã©ã†ã‹ã‚’åˆ¤å®š
 */
export function hasChildren(task: TaskNode): boolean {
  return task.children.length > 0;
}

/**
 * å®Œäº†ã—ãŸå­ã‚¿ã‚¹ã‚¯ã®æ•°ã¨ç·æ•°ã‚’å–å¾—
 */
export function getCompletionStats(task: TaskNode): { completed: number; total: number } {
  if (task.children.length === 0) {
    return { completed: 0, total: 0 };
  }

  const total = task.children.length;
  const completed = task.children.filter(child => isTaskCompleted(child)).length;

  return { completed, total };
}
```

#### 2. `src/components/TaskNode.tsx` - è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯æ›´æ–°

```typescript
import { isTaskCompleted, hasChildren, getCompletionStats } from '../utils/taskOperations';

const TaskNode = React.memo(function TaskNode({ task, ... }: TaskNodeProps) {
  // å®Œäº†çŠ¶æ…‹ã‚’è¨ˆç®—
  const isCompleted = isTaskCompleted(task);
  const isParent = hasChildren(task);
  const stats = isParent ? getCompletionStats(task) : null;

  return (
    <div className={`task-node ${isCompleted ? 'completed' : ''}`}>
      {/* ... */}

      <button
        className={`complete-btn ${isParent ? 'parent-task' : ''}`}
        onClick={(e) => {
          e.stopPropagation();
          // è¦ªã‚¿ã‚¹ã‚¯ã®å ´åˆã¯ã‚¯ãƒªãƒƒã‚¯ä¸å¯
          if (!isParent) {
            onToggleComplete(task.id);
          }
        }}
        disabled={isParent}
      >
        {isParent ? (
          // è¦ªã‚¿ã‚¹ã‚¯: é€²æ—è¡¨ç¤º
          <span className="progress-text">{stats!.completed}/{stats!.total}</span>
        ) : (
          // è‘‰ã‚¿ã‚¹ã‚¯: ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯
          isCompleted ? 'âœ“' : ''
        )}
      </button>
    </div>
  );
});
```

#### 3. `src/hooks/useTaskTree.ts` - å®Œäº†ãƒˆã‚°ãƒ«å‡¦ç†æ›´æ–°

```typescript
import { hasChildren } from '../utils/taskOperations';

// onToggleComplete ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å†…
const handleToggleComplete = useCallback((taskId: string) => {
  setTasks(prev => {
    const result = findTask(prev, taskId);
    if (!result) return prev;

    const { node } = result;

    // è¦ªã‚¿ã‚¹ã‚¯ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„
    if (hasChildren(node)) {
      return prev;
    }

    // è‘‰ã‚¿ã‚¹ã‚¯ã®ã¿å®Œäº†çŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«
    return updateTask(prev, taskId, {
      ...node,
      completed: !node.completed
    });
  });
}, []);
```

## UI/UXã®æ”¹å–„æ¡ˆ

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: è¦ªã‚¿ã‚¹ã‚¯ã¯é€²æ—è¡¨ç¤ºã®ã¿
```
è‘‰ã‚¿ã‚¹ã‚¯: [ âœ“ ]  (ã‚¯ãƒªãƒƒã‚¯å¯èƒ½)
è¦ªã‚¿ã‚¹ã‚¯: [3/5]  (ã‚¯ãƒªãƒƒã‚¯ä¸å¯ã€é€²æ—è¡¨ç¤º)
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: è¦ªã‚¿ã‚¹ã‚¯ã¯ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ + é€²æ—
```
è‘‰ã‚¿ã‚¹ã‚¯: [ âœ“ ]
è¦ªã‚¿ã‚¹ã‚¯: [ âœ“ ] 3/5  (è‡ªå‹•è¨ˆç®—ã€ã‚¯ãƒªãƒƒã‚¯ä¸å¯)
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³3: è¦ªã‚¿ã‚¹ã‚¯ã¯ä¸€æ‹¬å®Œäº†ãƒœã‚¿ãƒ³
```
è‘‰ã‚¿ã‚¹ã‚¯: [ âœ“ ]  (å€‹åˆ¥ãƒˆã‚°ãƒ«)
è¦ªã‚¿ã‚¹ã‚¯: [ âœ“ ] ã™ã¹ã¦å®Œäº†ã«ã™ã‚‹  (å­ã‚¿ã‚¹ã‚¯ã‚’ä¸€æ‹¬å®Œäº†)
```

**æ¨å¥¨**: ã‚ªãƒ—ã‚·ãƒ§ãƒ³1ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã§ç›´æ„Ÿçš„ï¼‰

## ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

```css
/* è¦ªã‚¿ã‚¹ã‚¯ã®å®Œäº†ãƒœã‚¿ãƒ³ */
.complete-btn.parent-task {
  cursor: default;
  opacity: 0.8;
  pointer-events: none;
}

.progress-text {
  font-size: 10px;
  font-weight: 600;
  color: #64748b;
}

/* è¦ªã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ã¦ã„ã‚‹å ´åˆ */
.task-node.completed .progress-text {
  color: #22c55e;
}
```

## å®Ÿè£…é †åº

1. âœ… å®Ÿè£…è¨ˆç”»ä½œæˆ
2. `taskOperations.ts` ã«ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°è¿½åŠ 
3. `TaskNode.tsx` ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯æ›´æ–°
4. `useTaskTree.ts` ã®å®Œäº†ãƒˆã‚°ãƒ«å‡¦ç†æ›´æ–°
5. ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°èª¿æ•´
6. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®äº’æ›æ€§ç¢ºèª
7. ãƒ†ã‚¹ãƒˆ

## ãƒ‡ãƒ¼ã‚¿äº’æ›æ€§

æ—¢å­˜ã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã«ã¯å½±éŸ¿ãªã—ï¼š
- æ—¢å­˜ã® `completed` ãƒ•ãƒ©ã‚°ã¯ãã®ã¾ã¾èª­ã¿è¾¼ã¾ã‚Œã‚‹
- è¦ªã‚¿ã‚¹ã‚¯ã« `completed` ãŒè¨­å®šã•ã‚Œã¦ã„ã¦ã‚‚ã€è¨ˆç®—ã§ä¸Šæ›¸ãã•ã‚Œã‚‹ãŸã‚å•é¡Œãªã—

## æ³¨æ„ç‚¹

1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**:
   - `isTaskCompleted` ã¯å†å¸°çš„ã«è¨ˆç®—ã™ã‚‹ãŸã‚ã€æ·±ã„ãƒ„ãƒªãƒ¼ã§ã¯æ³¨æ„
   - React.memo ã§æœ€é©åŒ–æ¸ˆã¿ã®ãŸã‚ã€å®Ÿç”¨ä¸Šã¯å•é¡Œãªã—

2. **ãƒ«ãƒ¼ãƒˆã‚¿ã‚¹ã‚¯**:
   - ãƒ«ãƒ¼ãƒˆã‚¿ã‚¹ã‚¯ã‚‚è¦ªã‚¿ã‚¹ã‚¯ã¨ã—ã¦æ‰±ã†
   - å…¨ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã™ã‚‹ã¨ãƒ«ãƒ¼ãƒˆã‚‚å®Œäº†çŠ¶æ…‹ã«ãªã‚‹

3. **ç©ºã®è¦ªã‚¿ã‚¹ã‚¯**:
   - å­ã‚¿ã‚¹ã‚¯ãŒã™ã¹ã¦å‰Šé™¤ã•ã‚ŒãŸå ´åˆã€è¦ªã¯è‡ªå‹•çš„ã«æœªå®Œäº†ã«ãªã‚‹
   - ãã®å¾Œã€è‘‰ã‚¿ã‚¹ã‚¯ã¨ã—ã¦æ‰‹å‹•ã§å®Œäº†å¯èƒ½
